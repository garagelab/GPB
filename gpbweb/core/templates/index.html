{% extends "base.html" %}
{% load objlink %}
{% load currency %}
{% load tiempo_en_letras %}
{% load meses %}
{% load common_html %}
{% load cache %}

{% block content %}
<div id="descripcion">
  <h2><strong>Gasto Público Bahiense</strong> es una herramienta para explorar los datos de compras a proveedores que publica la <strong>Municipalidad de Bahía Blanca, Argentina</strong>. <a href="javascript:void(0);">&rarr;</a></h2>
</div><!-- /descripcion -->

<div id="contador_gastos" class="clearfix">
  {% tiempo_en_letras start_date end_date as periodo %}
  <h3>{{periodo|first_upper}}, la Municipalidad de Bahía Blanca:</h3>
  <dl class="small first">
    <div>
      <dd>Emitió órdenes de compra por</dd>
      <dt>{{gasto_mensual_total|currency}}</dt>
    </div>
  </dl>
  <dl class="small">
    <div>
      <dd>Promedio de gasto mensual</dd>
      <dt>{{gasto_mensual_promedio|currency}}</dt>
    </div>
  </dl>
  <dl class="small">
    <div>
      <dd>Proveedores Totales</dd>
      <dt>{{cantidad_proveedores_unicos}}</dt>
    </div>
  </dl>
  <dl class="small last">
    <div>
      <dd>Cantidad de Ordenes de Compra</dd>
      <dt>{{cantidad_ordenes_de_compra}}</dt>
    </div>
  </dl>
</div><!-- /contador_gastos -->
{% include "filtro.html" %}
<div id="contenedor" class="clearfix">
  <div class="bloque">
    <div class="caja izquierda">
      <h4>Las 5 reparticiones que más gastaron {{periodo}}</h4>
      <p>Para ver más info mueva el mouse sobre el gráfico:</p>
      <div id="piechart_div"></div> 
    </div><!-- /caja izquierda -->
    <div class="caja derecha">
      <h4>Los 10 proveedores más beneficiados {{periodo}}</h4>
      <p>Para ver más info haga clic en cualquiera de los siguientes items listados a continuación:</p>
      
      <ol class="lista-proveedores">
	{% for p in proveedores|slice:":10" %}
	<li>{{p|objlink}}<strong>{{p.total_compras|currency}}</strong></li>
	{% endfor %}
      </ol>

      <h4>Palabras clave en las ordenes de compra</h4>
      <p>Para ver más info haga clic en cualquiera de los siguientes items listados a continuación:</p>
    </div><!-- /caja derecha -->
  </div><!-- /bloque -->
  <div class="bloque">
    <h3 class="grande">Evolución del gasto {{periodo}}</h3>
    <div id="table_div_jscode" style="height: 200px; width: 100%"></div>
  </div><!-- /bloque -->
  <div class="bloque">
    <h3 class="grande">Ordenes de compra emitidas por la Municipalidad {{periodo}}</h3>
    <p>Las órdenes de compra aquí exhibidas se extraen de la sección <a href="http://www.bahiablanca.gov.ar/compras/comprasrealizadas.aspx"><strong>Compras Realizadas</strong></a> del sitio web de la Municipalidad de Bahía Blanca, única fuente oficial para dicha información.</p>
    <table class="ordenes_de_compra table">
      {% regroup ordenes_de_compra by fecha as compras_por_dia %}
      <colgroup>
	<col class="destino" />
	<col class="proveedor" />
	<col class="importe" />
	<col class="detalle" />
      </colgroup>
      <tbody>
	<tr class="encabezados">
	  <th>Destino</th>
	  <th>Proveedor</th>
	  <th>Importe</th>
	  <th></th>
	</tr>
	{% for dia in compras_por_dia|slice:":4" %}						

	<tr class="grupo_fecha">
	  <th colspan="4">{{dia.grouper|date:"d/m/Y"}}</th>
	</tr>
	{% for c in dia.list %}
	<tr class="orden">
	  <td>{{c.destino|objlink}}</td>
	  <td>{{c.proveedor|objlink}}</td>
	  <td>{{c.importe|currency}}</td>
	  <td><a class="ordenes_de_compra_detalle" href="{{c.get_absolute_url}}">Ver detalle</a></td>
	</tr>
	{% endfor %}
	{% endfor %}

      </tbody>
    </table>
    <p class="caja-destacada"><a href="#">Ver todas las ordenes de compra emitidas por la municipalidad en lo que va del año 2011</a> (<a href="#">CSV</a>) ― <a class="rss-link" href="#">Feed RSS de órdenes de compra</a></p>
  </div><!-- /bloque -->
</div><!-- /contenedor -->
{% endblock %}

